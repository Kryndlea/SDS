{
  "hash": "2042e70bef844146642a15f82b70d74e",
  "result": {
    "markdown": "---\ntitle: Data wrangling\nformat:\n  html: default\n  ipynb: default\n---\n\n::: {.callout-caution}\nThis course material is currently under construction and is likely incomplete. The final\nversion will be released in October 2023.\n:::\n\nYou know the basics. What are Jupyter notebooks, how do they work, and how do you run\nPython in them. It is time to start using them for data science (no, that simple math\nyou did the last time doesn't count as data science).\n\nYou are about to enter the PyData ecosystem. It means that you will start learning\nhow to work with Python from the middle. This course does not explicitly cover the\nfundamentals of programming. It is expected that those parts you need you'll be able to\npick as you go through the specialised data science stack. If you're stuck,\nconfused or need further explanation, use Google (or your favourite\nsearch engine), ask AI to explain the code or ask in Slack or during the class. Not\neverything will be told during the course (by design), and the internet is a friend of\nevery programmer, so let's figure out how to use it efficiently from the beginning.\n\nLet's dig in!\n\n## Munging and wrangling\n\nReal-world datasets are messy. There is no way around it: datasets have “holes” (missing\ndata), the amount of formats in which data can be stored is endless, and the best\nstructure to share data is not always the optimum to analyse them, hence the need to\n[munge](http://dictionary.reference.com/browse/munge)[^1] them. As has been correctly\npointed out in many outlets, much of the time spent in what is called Data Science is\nrelated not only to sophisticated modelling and insight but has to do with much more\nbasic and less exotic tasks such as obtaining data, processing, and turning them into a\nshape that makes analysis possible, and exploring it to get to know their basic\nproperties.\n\n[^1]: Data munging and data wrangling are used interchangeably. Pick the one you like.\n\nSurprisingly, very little has been published on patterns, techniques, and best practices\nfor quick and efficient data cleaning, manipulation, and transformation because of how\nlabour-intensive and relevant this aspect is. In this session, you will use a few\nreal-world datasets and learn how to process them into Python so they can be transformed\nand manipulated, if necessary, and analysed. For this, you will introduce some of the\nbread and butter of data analysis and scientific computing in Python. These are\nfundamental tools that are constantly used in almost any task relating to data analysis.\n\nThis notebook covers the basics and the content that is expected to be learnt by every\nstudent. You use a prepared dataset that saves us much of the more intricate processing\nthat goes beyond the introductory level the session is aimed at. If you are interested\nin how it was done, there is a\n[notebook](https://github.com/martinfleis/sds/blob/main/data/chicago_influenza_1918/preprocessing.ipynb).\n\nThis notebook discusses several patterns to clean and structure data properly,\nincluding tidying, subsetting, and aggregating. You finish with some basic visualisation.\nAn additional extension presents more advanced tricks to manipulate tabular data.\n\n## Dataset\n\nYou will be exploring demographic characteristics of Chicago in 1918 linked to the\ninfluenza mortality during the pandemic that happened back then, coming from the\nresearch paper by @grantz2016disparities. The data are aggregated to census tracts and\ncontain information on unemployment, home ownership, age structure and influenza\nmortality from a period of 8 weeks.\n\nThe main tool you use is the `pandas` package. As with the `math` you used\n[before](../chapter_01/hands_on.qmd), you must import it first.\n\n::: {#63785b73 .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd  # <1>\n```\n:::\n\n\n1. Import the `pandas` package under the alias `pd`. Using the alias is not\nnecessary, but it is a convention nearly everyone follows.\n\nThe data is stored in a CSV file. To make things easier, you can read data from a file\nposted online so, for now, you do not need to download any dataset:\n\n::: {#870a0fa6 .cell execution_count=2}\n``` {.python .cell-code}\nchicago_1918 = pd.read_csv(                                                         # <1>\n    \"https://martinfleischmann.net/sds/chapter_02/data/chicago_influenza_1918.csv\", # <2>\n    index_col=\"geography_code\",                                                     # <3>\n)\n```\n:::\n\n\n1. Use the `read_csv` function from `pandas`. Remember that you have imported `pandas` as `pd`.\n2. Specify the path to the file. It could be a web address like here or a local file path.\n3. Use the column `geography_code` as an index of the table by passing its name to the\n`index_col` keyword argument. It is not strictly necessary but allows us to choose and index\non reading instead of specifying it later. More on indices below.\n\n::: {.callout-tip}\nYou are using `read_csv` because the file you want to read is in CSV format. However,\n`pandas` allows for many more formats to be read and write. A full list of formats\nsupported may be found in [the documentation](https://pandas.pydata.org/docs/user_guide/io.html).\n:::\n\n::: {.callout-note}\n## Alternative\nInstead of reading the file directly off the web, it is possible to download it manually,\n store it on your computer, and read it locally. To do that, you can follow these steps:\n\n1. Download the file by right-clicking on\n[this link](https://martinfleischmann.net/sds/chapter_02/data/chicago_influenza_1918.csv)\nand saving the file\n2. Place the file in the same folder as the notebook where you intend to read it\n3. Replace the code in the cell above with:\n\n```python\nchicago_1918 = pd.read_csv(\n    \"chicago_influenza_1918.csv\",\n    index_col=\"geography_code\",\n)\n```\n:::\n## Pandas 101\n\nNow, you are ready to start playing and interrogating the dataset! What you have at your\nfingertips is a table summarising, for each of the census tracts in Chicago more than\na century ago, how many people lived in each by age, accompanied by some other\nsocioeconomic data and influenza mortality. These tables are called `DataFrame` objects,\nand they have a lot of functionality built-in to explore and manipulate the data they\ncontain. Let’s explore a few of those cool tricks!\n\n### Data Structures\n\nThe first aspect worth spending a bit of time on is the structure of a `DataFrame`. You\ncan print it by simply typing its name:\n\n::: {#0d326d92 .cell execution_count=3}\n``` {.python .cell-code}\nchicago_1918\n```\n\n::: {.cell-output .cell-output-display execution_count=3}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>1388.2</td>\n      <td>116</td>\n      <td>0.376950</td>\n      <td>0.124823</td>\n      <td>46</td>\n      <td>274</td>\n      <td>257</td>\n      <td>311</td>\n      <td>222</td>\n      <td>1122</td>\n      <td>587</td>\n      <td>9</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>217.7</td>\n      <td>14</td>\n      <td>0.399571</td>\n      <td>0.071647</td>\n      <td>35</td>\n      <td>320</td>\n      <td>441</td>\n      <td>624</td>\n      <td>276</td>\n      <td>1061</td>\n      <td>508</td>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>401.3</td>\n      <td>69</td>\n      <td>0.349558</td>\n      <td>0.092920</td>\n      <td>50</td>\n      <td>265</td>\n      <td>179</td>\n      <td>187</td>\n      <td>163</td>\n      <td>1020</td>\n      <td>392</td>\n      <td>8</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>86.9</td>\n      <td>11</td>\n      <td>0.422535</td>\n      <td>0.030072</td>\n      <td>43</td>\n      <td>241</td>\n      <td>129</td>\n      <td>141</td>\n      <td>123</td>\n      <td>1407</td>\n      <td>539</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>G17003100005</th>\n      <td>337.1</td>\n      <td>20</td>\n      <td>0.431822</td>\n      <td>0.084703</td>\n      <td>65</td>\n      <td>464</td>\n      <td>369</td>\n      <td>464</td>\n      <td>328</td>\n      <td>2625</td>\n      <td>1213</td>\n      <td>7</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>G17003100492</th>\n      <td>2176.6</td>\n      <td>136</td>\n      <td>0.404430</td>\n      <td>0.173351</td>\n      <td>85</td>\n      <td>606</td>\n      <td>520</td>\n      <td>705</td>\n      <td>439</td>\n      <td>2141</td>\n      <td>1460</td>\n      <td>12</td>\n    </tr>\n    <tr>\n      <th>G17003100493</th>\n      <td>680.0</td>\n      <td>271</td>\n      <td>0.377207</td>\n      <td>0.130158</td>\n      <td>243</td>\n      <td>1349</td>\n      <td>957</td>\n      <td>1264</td>\n      <td>957</td>\n      <td>4653</td>\n      <td>2180</td>\n      <td>40</td>\n    </tr>\n    <tr>\n      <th>G17003100494</th>\n      <td>1392.8</td>\n      <td>1504</td>\n      <td>0.336032</td>\n      <td>0.072317</td>\n      <td>309</td>\n      <td>1779</td>\n      <td>1252</td>\n      <td>1598</td>\n      <td>1086</td>\n      <td>6235</td>\n      <td>2673</td>\n      <td>85</td>\n    </tr>\n    <tr>\n      <th>G17003100495</th>\n      <td>640.0</td>\n      <td>167</td>\n      <td>0.311917</td>\n      <td>0.085667</td>\n      <td>59</td>\n      <td>333</td>\n      <td>206</td>\n      <td>193</td>\n      <td>80</td>\n      <td>726</td>\n      <td>224</td>\n      <td>15</td>\n    </tr>\n    <tr>\n      <th>G17003100496</th>\n      <td>709.8</td>\n      <td>340</td>\n      <td>0.369765</td>\n      <td>0.113549</td>\n      <td>157</td>\n      <td>979</td>\n      <td>761</td>\n      <td>959</td>\n      <td>594</td>\n      <td>2862</td>\n      <td>1206</td>\n      <td>30</td>\n    </tr>\n  </tbody>\n</table>\n<p>496 rows × 12 columns</p>\n</div>\n```\n:::\n:::\n\n\nNote the printing is cut to keep a nice and compact view but enough to see its\nstructure. Since they represent a table of data, `DataFrame` objects have two dimensions:\nrows and columns. Each of these is automatically assigned a name in what you will call\nits _index_. When printing, the index of each dimension is rendered in bold, as opposed\nto the standard rendering for the content. The example above shows how the\ncolumn index is automatically picked up from the `.csv` file’s column names. For rows,\nwe have specified when reading the file you wanted the column `geography_code`, so that is\nused. If you hadn’t set any, `pandas` would automatically generate a sequence starting\nin `0` and going all the way to the number of rows minus one. This is the standard\nstructure of a `DataFrame` object, so you will come to it over and over. Importantly, even\nwhen you move to spatial data, your datasets will have a similar structure.\n\nOne final feature that is worth mentioning about these tables is that they can hold\ncolumns with different types of data. In this example, you have\ncounts (or `int` for integer types) and ratios (or 'float' for floating point numbers\n - a number with decimals) for each column. But it is useful to keep in mind that\nyou can combine this with columns that hold other types of data such as categories, text\n(`str`, for string), dates or, as you will see later in the course, geographic features.\n\nTo extract a single column from this `DataFrame`, specify its name\nin the square brackets (`[]`). Note that the name, in this case, is a `string`. A piece\nof text. As such, it needs to be within single (`'`) or double quotes (`\"`). The resulting\ndata structure is no longer a `DataFrame`, but you have a `Series` because you deal with a\nsingle column.\n\n::: {#165eb9a5 .cell execution_count=4}\n``` {.python .cell-code}\nchicago_1918[\"influenza\"]\n```\n\n::: {.cell-output .cell-output-display execution_count=4}\n```\ngeography_code\nG17003100001     9\nG17003100002     6\nG17003100003     8\nG17003100004     2\nG17003100005     7\n                ..\nG17003100492    12\nG17003100493    40\nG17003100494    85\nG17003100495    15\nG17003100496    30\nName: influenza, Length: 496, dtype: int64\n```\n:::\n:::\n\n\n### Inspect\n\nInspecting what it looks like. You can check the table's top (or bottom) X lines by\npassing X to the method `head` (`tail`). For example, for the top/bottom five lines:\n\n::: {#fd707c84 .cell execution_count=5}\n``` {.python .cell-code}\nchicago_1918.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>1388.2</td>\n      <td>116</td>\n      <td>0.376950</td>\n      <td>0.124823</td>\n      <td>46</td>\n      <td>274</td>\n      <td>257</td>\n      <td>311</td>\n      <td>222</td>\n      <td>1122</td>\n      <td>587</td>\n      <td>9</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>217.7</td>\n      <td>14</td>\n      <td>0.399571</td>\n      <td>0.071647</td>\n      <td>35</td>\n      <td>320</td>\n      <td>441</td>\n      <td>624</td>\n      <td>276</td>\n      <td>1061</td>\n      <td>508</td>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>401.3</td>\n      <td>69</td>\n      <td>0.349558</td>\n      <td>0.092920</td>\n      <td>50</td>\n      <td>265</td>\n      <td>179</td>\n      <td>187</td>\n      <td>163</td>\n      <td>1020</td>\n      <td>392</td>\n      <td>8</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>86.9</td>\n      <td>11</td>\n      <td>0.422535</td>\n      <td>0.030072</td>\n      <td>43</td>\n      <td>241</td>\n      <td>129</td>\n      <td>141</td>\n      <td>123</td>\n      <td>1407</td>\n      <td>539</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>G17003100005</th>\n      <td>337.1</td>\n      <td>20</td>\n      <td>0.431822</td>\n      <td>0.084703</td>\n      <td>65</td>\n      <td>464</td>\n      <td>369</td>\n      <td>464</td>\n      <td>328</td>\n      <td>2625</td>\n      <td>1213</td>\n      <td>7</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {#d336fb56 .cell execution_count=6}\n``` {.python .cell-code}\nchicago_1918.tail()\n```\n\n::: {.cell-output .cell-output-display execution_count=6}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100492</th>\n      <td>2176.6</td>\n      <td>136</td>\n      <td>0.404430</td>\n      <td>0.173351</td>\n      <td>85</td>\n      <td>606</td>\n      <td>520</td>\n      <td>705</td>\n      <td>439</td>\n      <td>2141</td>\n      <td>1460</td>\n      <td>12</td>\n    </tr>\n    <tr>\n      <th>G17003100493</th>\n      <td>680.0</td>\n      <td>271</td>\n      <td>0.377207</td>\n      <td>0.130158</td>\n      <td>243</td>\n      <td>1349</td>\n      <td>957</td>\n      <td>1264</td>\n      <td>957</td>\n      <td>4653</td>\n      <td>2180</td>\n      <td>40</td>\n    </tr>\n    <tr>\n      <th>G17003100494</th>\n      <td>1392.8</td>\n      <td>1504</td>\n      <td>0.336032</td>\n      <td>0.072317</td>\n      <td>309</td>\n      <td>1779</td>\n      <td>1252</td>\n      <td>1598</td>\n      <td>1086</td>\n      <td>6235</td>\n      <td>2673</td>\n      <td>85</td>\n    </tr>\n    <tr>\n      <th>G17003100495</th>\n      <td>640.0</td>\n      <td>167</td>\n      <td>0.311917</td>\n      <td>0.085667</td>\n      <td>59</td>\n      <td>333</td>\n      <td>206</td>\n      <td>193</td>\n      <td>80</td>\n      <td>726</td>\n      <td>224</td>\n      <td>15</td>\n    </tr>\n    <tr>\n      <th>G17003100496</th>\n      <td>709.8</td>\n      <td>340</td>\n      <td>0.369765</td>\n      <td>0.113549</td>\n      <td>157</td>\n      <td>979</td>\n      <td>761</td>\n      <td>959</td>\n      <td>594</td>\n      <td>2862</td>\n      <td>1206</td>\n      <td>30</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nOr get an overview of the table:\n\n::: {#63b076cc .cell execution_count=7}\n``` {.python .cell-code}\nchicago_1918.info()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n<class 'pandas.core.frame.DataFrame'>\nIndex: 496 entries, G17003100001 to G17003100496\nData columns (total 12 columns):\n #   Column          Non-Null Count  Dtype  \n---  ------          --------------  -----  \n 0   gross_acres     496 non-null    float64\n 1   illit           496 non-null    int64  \n 2   unemployed_pct  496 non-null    float64\n 3   ho_pct          496 non-null    float64\n 4   agecat1         496 non-null    int64  \n 5   agecat2         496 non-null    int64  \n 6   agecat3         496 non-null    int64  \n 7   agecat4         496 non-null    int64  \n 8   agecat5         496 non-null    int64  \n 9   agecat6         496 non-null    int64  \n 10  agecat7         496 non-null    int64  \n 11  influenza       496 non-null    int64  \ndtypes: float64(3), int64(9)\nmemory usage: 66.5+ KB\n```\n:::\n:::\n\n\n### Summarise\n\nOr of the _values_ of the table:\n\n::: {#ff070672 .cell execution_count=8}\n``` {.python .cell-code}\nchicago_1918.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=8}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>count</th>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n      <td>496.000000</td>\n    </tr>\n    <tr>\n      <th>mean</th>\n      <td>233.245968</td>\n      <td>199.116935</td>\n      <td>0.345818</td>\n      <td>0.061174</td>\n      <td>102.370968</td>\n      <td>555.167339</td>\n      <td>406.560484</td>\n      <td>524.100806</td>\n      <td>416.044355</td>\n      <td>2361.582661</td>\n      <td>1052.681452</td>\n      <td>16.070565</td>\n    </tr>\n    <tr>\n      <th>std</th>\n      <td>391.630857</td>\n      <td>297.836201</td>\n      <td>0.050498</td>\n      <td>0.038189</td>\n      <td>78.677423</td>\n      <td>423.526444</td>\n      <td>301.564896</td>\n      <td>369.875444</td>\n      <td>281.825682</td>\n      <td>1545.469426</td>\n      <td>722.955717</td>\n      <td>12.252440</td>\n    </tr>\n    <tr>\n      <th>min</th>\n      <td>6.900000</td>\n      <td>0.000000</td>\n      <td>0.057800</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>3.000000</td>\n      <td>1.000000</td>\n      <td>4.000000</td>\n      <td>0.000000</td>\n      <td>8.000000</td>\n      <td>6.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>25%</th>\n      <td>79.975000</td>\n      <td>30.750000</td>\n      <td>0.323973</td>\n      <td>0.032106</td>\n      <td>46.750000</td>\n      <td>256.500000</td>\n      <td>193.500000</td>\n      <td>253.750000</td>\n      <td>220.500000</td>\n      <td>1169.750000</td>\n      <td>519.750000</td>\n      <td>8.000000</td>\n    </tr>\n    <tr>\n      <th>50%</th>\n      <td>99.500000</td>\n      <td>84.000000</td>\n      <td>0.353344</td>\n      <td>0.054389</td>\n      <td>82.000000</td>\n      <td>442.500000</td>\n      <td>331.500000</td>\n      <td>453.500000</td>\n      <td>377.000000</td>\n      <td>2102.000000</td>\n      <td>918.500000</td>\n      <td>13.500000</td>\n    </tr>\n    <tr>\n      <th>75%</th>\n      <td>180.125000</td>\n      <td>241.250000</td>\n      <td>0.373382</td>\n      <td>0.084762</td>\n      <td>136.000000</td>\n      <td>717.500000</td>\n      <td>532.500000</td>\n      <td>709.500000</td>\n      <td>551.750000</td>\n      <td>3191.750000</td>\n      <td>1379.250000</td>\n      <td>21.000000</td>\n    </tr>\n    <tr>\n      <th>max</th>\n      <td>3840.000000</td>\n      <td>2596.000000</td>\n      <td>0.495413</td>\n      <td>0.197391</td>\n      <td>427.000000</td>\n      <td>2512.000000</td>\n      <td>1917.000000</td>\n      <td>2665.000000</td>\n      <td>2454.000000</td>\n      <td>9792.000000</td>\n      <td>4163.000000</td>\n      <td>85.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nNote how the output is also a `DataFrame` object, so you can do with it the same things\nyou would with the original table (e.g. writing it to a file).\n\nIn this case, the summary might be better presented if the table is “transposed”:\n\n::: {#60355b93 .cell execution_count=9}\n``` {.python .cell-code}\nchicago_1918.describe().T\n```\n\n::: {.cell-output .cell-output-display execution_count=9}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>count</th>\n      <th>mean</th>\n      <th>std</th>\n      <th>min</th>\n      <th>25%</th>\n      <th>50%</th>\n      <th>75%</th>\n      <th>max</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>gross_acres</th>\n      <td>496.0</td>\n      <td>233.245968</td>\n      <td>391.630857</td>\n      <td>6.9000</td>\n      <td>79.975000</td>\n      <td>99.500000</td>\n      <td>180.125000</td>\n      <td>3840.000000</td>\n    </tr>\n    <tr>\n      <th>illit</th>\n      <td>496.0</td>\n      <td>199.116935</td>\n      <td>297.836201</td>\n      <td>0.0000</td>\n      <td>30.750000</td>\n      <td>84.000000</td>\n      <td>241.250000</td>\n      <td>2596.000000</td>\n    </tr>\n    <tr>\n      <th>unemployed_pct</th>\n      <td>496.0</td>\n      <td>0.345818</td>\n      <td>0.050498</td>\n      <td>0.0578</td>\n      <td>0.323973</td>\n      <td>0.353344</td>\n      <td>0.373382</td>\n      <td>0.495413</td>\n    </tr>\n    <tr>\n      <th>ho_pct</th>\n      <td>496.0</td>\n      <td>0.061174</td>\n      <td>0.038189</td>\n      <td>0.0000</td>\n      <td>0.032106</td>\n      <td>0.054389</td>\n      <td>0.084762</td>\n      <td>0.197391</td>\n    </tr>\n    <tr>\n      <th>agecat1</th>\n      <td>496.0</td>\n      <td>102.370968</td>\n      <td>78.677423</td>\n      <td>0.0000</td>\n      <td>46.750000</td>\n      <td>82.000000</td>\n      <td>136.000000</td>\n      <td>427.000000</td>\n    </tr>\n    <tr>\n      <th>agecat2</th>\n      <td>496.0</td>\n      <td>555.167339</td>\n      <td>423.526444</td>\n      <td>3.0000</td>\n      <td>256.500000</td>\n      <td>442.500000</td>\n      <td>717.500000</td>\n      <td>2512.000000</td>\n    </tr>\n    <tr>\n      <th>agecat3</th>\n      <td>496.0</td>\n      <td>406.560484</td>\n      <td>301.564896</td>\n      <td>1.0000</td>\n      <td>193.500000</td>\n      <td>331.500000</td>\n      <td>532.500000</td>\n      <td>1917.000000</td>\n    </tr>\n    <tr>\n      <th>agecat4</th>\n      <td>496.0</td>\n      <td>524.100806</td>\n      <td>369.875444</td>\n      <td>4.0000</td>\n      <td>253.750000</td>\n      <td>453.500000</td>\n      <td>709.500000</td>\n      <td>2665.000000</td>\n    </tr>\n    <tr>\n      <th>agecat5</th>\n      <td>496.0</td>\n      <td>416.044355</td>\n      <td>281.825682</td>\n      <td>0.0000</td>\n      <td>220.500000</td>\n      <td>377.000000</td>\n      <td>551.750000</td>\n      <td>2454.000000</td>\n    </tr>\n    <tr>\n      <th>agecat6</th>\n      <td>496.0</td>\n      <td>2361.582661</td>\n      <td>1545.469426</td>\n      <td>8.0000</td>\n      <td>1169.750000</td>\n      <td>2102.000000</td>\n      <td>3191.750000</td>\n      <td>9792.000000</td>\n    </tr>\n    <tr>\n      <th>agecat7</th>\n      <td>496.0</td>\n      <td>1052.681452</td>\n      <td>722.955717</td>\n      <td>6.0000</td>\n      <td>519.750000</td>\n      <td>918.500000</td>\n      <td>1379.250000</td>\n      <td>4163.000000</td>\n    </tr>\n    <tr>\n      <th>influenza</th>\n      <td>496.0</td>\n      <td>16.070565</td>\n      <td>12.252440</td>\n      <td>0.0000</td>\n      <td>8.000000</td>\n      <td>13.500000</td>\n      <td>21.000000</td>\n      <td>85.000000</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nEqually, common descriptive statistics are also available. To obtain minimum values for\neach column, you can use `.min()`.\n\n::: {#8fa99a82 .cell execution_count=10}\n``` {.python .cell-code}\nchicago_1918.min()\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```\ngross_acres       6.9000\nillit             0.0000\nunemployed_pct    0.0578\nho_pct            0.0000\nagecat1           0.0000\nagecat2           3.0000\nagecat3           1.0000\nagecat4           4.0000\nagecat5           0.0000\nagecat6           8.0000\nagecat7           6.0000\ninfluenza         0.0000\ndtype: float64\n```\n:::\n:::\n\n\nOr to obtain a minimum for a single column only.\n\n::: {#95543080 .cell execution_count=11}\n``` {.python .cell-code}\nchicago_1918[\"influenza\"].min()\n```\n\n::: {.cell-output .cell-output-display execution_count=11}\n```\n0\n```\n:::\n:::\n\n\nNote here how you have restricted the calculation of the minimum value to one column only\nby getting the `Series` and calling `.min()` on that.\n\nSimilarly, you can restrict the calculations to a single row using `.loc[]` indexer:\n\n::: {#fc08067b .cell execution_count=12}\n``` {.python .cell-code}\nchicago_1918.loc[\"G17003100492\"].max()\n```\n\n::: {.cell-output .cell-output-display execution_count=12}\n```\n2176.6\n```\n:::\n:::\n\n\n### Create new columns\n\nYou can generate new variables by applying operations to existing ones. For example, you\ncan calculate the total population by area. Here are a couple of ways to do it:\n\n::: {#5ecada33 .cell execution_count=13}\n``` {.python .cell-code}\n# This one is longer, hardcoded\ntotal_population = (            # <1>\n    chicago_1918[\"agecat1\"]     # <2>\n    + chicago_1918[\"agecat2\"]   # <2>\n    + chicago_1918[\"agecat3\"]   # <2>\n    + chicago_1918[\"agecat4\"]   # <2>\n    + chicago_1918[\"agecat5\"]   # <2>\n    + chicago_1918[\"agecat6\"]   # <2>\n    + chicago_1918[\"agecat7\"]   # <2>\n)\ntotal_population.head()         # <3>\n```\n\n::: {.cell-output .cell-output-display execution_count=13}\n```\ngeography_code\nG17003100001    2819\nG17003100002    3265\nG17003100003    2256\nG17003100004    2623\nG17003100005    5528\ndtype: int64\n```\n:::\n:::\n\n\n1. Create a new variable called `total_population` to store the result.\n2. Select all the columns and add them together\n3. Print the top of the variable\n\n::: {#83ac5798 .cell execution_count=14}\n``` {.python .cell-code}\n# This one is shorted, using a range of columns and sum\ntotal_population = chicago_1918.loc[:, \"agecat1\":\"agecat7\"].sum(axis=1)  # <1>\ntotal_population.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=14}\n```\ngeography_code\nG17003100001    2819\nG17003100002    3265\nG17003100003    2256\nG17003100004    2623\nG17003100005    5528\ndtype: int64\n```\n:::\n:::\n\n\n1. This line is simple, but a lot happens here. Using `.loc[]`, you select all the rows\n(`:` part) and all the columns between `\"agecat1\"` and `\"agecat7\"`. Then you apply\n`.sum()` over `axis=1`, which means along rows, to get a sum per each row.\n\nOnce you have created the variable, you can make it part of the table:\n\n::: {#c550637e .cell execution_count=15}\n``` {.python .cell-code}\nchicago_1918[\"total_population\"] = total_population  # <1>\nchicago_1918.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=15}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>1388.2</td>\n      <td>116</td>\n      <td>0.376950</td>\n      <td>0.124823</td>\n      <td>46</td>\n      <td>274</td>\n      <td>257</td>\n      <td>311</td>\n      <td>222</td>\n      <td>1122</td>\n      <td>587</td>\n      <td>9</td>\n      <td>2819</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>217.7</td>\n      <td>14</td>\n      <td>0.399571</td>\n      <td>0.071647</td>\n      <td>35</td>\n      <td>320</td>\n      <td>441</td>\n      <td>624</td>\n      <td>276</td>\n      <td>1061</td>\n      <td>508</td>\n      <td>6</td>\n      <td>3265</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>401.3</td>\n      <td>69</td>\n      <td>0.349558</td>\n      <td>0.092920</td>\n      <td>50</td>\n      <td>265</td>\n      <td>179</td>\n      <td>187</td>\n      <td>163</td>\n      <td>1020</td>\n      <td>392</td>\n      <td>8</td>\n      <td>2256</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>86.9</td>\n      <td>11</td>\n      <td>0.422535</td>\n      <td>0.030072</td>\n      <td>43</td>\n      <td>241</td>\n      <td>129</td>\n      <td>141</td>\n      <td>123</td>\n      <td>1407</td>\n      <td>539</td>\n      <td>2</td>\n      <td>2623</td>\n    </tr>\n    <tr>\n      <th>G17003100005</th>\n      <td>337.1</td>\n      <td>20</td>\n      <td>0.431822</td>\n      <td>0.084703</td>\n      <td>65</td>\n      <td>464</td>\n      <td>369</td>\n      <td>464</td>\n      <td>328</td>\n      <td>2625</td>\n      <td>1213</td>\n      <td>7</td>\n      <td>5528</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n1. Assing a variable `total_population` that contains a `Series` as a column\n`\"total_population\"`. `pandas` creates that column automatically. If it existed, it would\nget overridden.\n\nYou can also do other mathematical operations on columns. These are always automatically\napplied to individual values in corresponding rows.\n\n::: {#59060ff0 .cell execution_count=16}\n``` {.python .cell-code}\nhomeowners = chicago_1918[\"total_population\"] * chicago_1918[\"ho_pct\"]  # <1>\nhomeowners.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```\ngeography_code\nG17003100001    351.875177\nG17003100002    233.928353\nG17003100003    209.628319\nG17003100004     78.879711\nG17003100005    468.237675\ndtype: float64\n```\n:::\n:::\n\n\n1. A product of the total population and home ownership percentage provides an estimation\nof the number of homeowners per census tract.\n\n::: {#637a762f .cell execution_count=17}\n``` {.python .cell-code}\npop_density = chicago_1918[\"total_population\"] / chicago_1918[\"gross_acres\"]  # <1>\npop_density.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=17}\n```\ngeography_code\nG17003100001     2.030687\nG17003100002    14.997703\nG17003100003     5.621729\nG17003100004    30.184120\nG17003100005    16.398695\ndtype: float64\n```\n:::\n:::\n\n\n1. A division of the total population by the area results in an estimation\nof the population density.\n\nA different spin on this is assigning new values: you can generate new variables with\nscalars[^scalar], and modify those:\n\n[^scalar]: Scalar is a single value, like a number (`42`) or a string (`\"towel\"`).\n\n::: {#c908b1be .cell execution_count=18}\n``` {.python .cell-code}\nchicago_1918[\"ones\"] = 1  # <1>\nchicago_1918.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=18}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n      <th>ones</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>1388.2</td>\n      <td>116</td>\n      <td>0.376950</td>\n      <td>0.124823</td>\n      <td>46</td>\n      <td>274</td>\n      <td>257</td>\n      <td>311</td>\n      <td>222</td>\n      <td>1122</td>\n      <td>587</td>\n      <td>9</td>\n      <td>2819</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>217.7</td>\n      <td>14</td>\n      <td>0.399571</td>\n      <td>0.071647</td>\n      <td>35</td>\n      <td>320</td>\n      <td>441</td>\n      <td>624</td>\n      <td>276</td>\n      <td>1061</td>\n      <td>508</td>\n      <td>6</td>\n      <td>3265</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>401.3</td>\n      <td>69</td>\n      <td>0.349558</td>\n      <td>0.092920</td>\n      <td>50</td>\n      <td>265</td>\n      <td>179</td>\n      <td>187</td>\n      <td>163</td>\n      <td>1020</td>\n      <td>392</td>\n      <td>8</td>\n      <td>2256</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>86.9</td>\n      <td>11</td>\n      <td>0.422535</td>\n      <td>0.030072</td>\n      <td>43</td>\n      <td>241</td>\n      <td>129</td>\n      <td>141</td>\n      <td>123</td>\n      <td>1407</td>\n      <td>539</td>\n      <td>2</td>\n      <td>2623</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>G17003100005</th>\n      <td>337.1</td>\n      <td>20</td>\n      <td>0.431822</td>\n      <td>0.084703</td>\n      <td>65</td>\n      <td>464</td>\n      <td>369</td>\n      <td>464</td>\n      <td>328</td>\n      <td>2625</td>\n      <td>1213</td>\n      <td>7</td>\n      <td>5528</td>\n      <td>1</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n1. Create a new column named `\"ones\"` with all ones.\n\nAnd you can modify specific values too:\n\n::: {#36bd042d .cell execution_count=19}\n``` {.python .cell-code}\nchicago_1918.loc[\"G17003100001\", \"ones\"] = 3\nchicago_1918.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=19}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n      <th>ones</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>1388.2</td>\n      <td>116</td>\n      <td>0.376950</td>\n      <td>0.124823</td>\n      <td>46</td>\n      <td>274</td>\n      <td>257</td>\n      <td>311</td>\n      <td>222</td>\n      <td>1122</td>\n      <td>587</td>\n      <td>9</td>\n      <td>2819</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>217.7</td>\n      <td>14</td>\n      <td>0.399571</td>\n      <td>0.071647</td>\n      <td>35</td>\n      <td>320</td>\n      <td>441</td>\n      <td>624</td>\n      <td>276</td>\n      <td>1061</td>\n      <td>508</td>\n      <td>6</td>\n      <td>3265</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>401.3</td>\n      <td>69</td>\n      <td>0.349558</td>\n      <td>0.092920</td>\n      <td>50</td>\n      <td>265</td>\n      <td>179</td>\n      <td>187</td>\n      <td>163</td>\n      <td>1020</td>\n      <td>392</td>\n      <td>8</td>\n      <td>2256</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>86.9</td>\n      <td>11</td>\n      <td>0.422535</td>\n      <td>0.030072</td>\n      <td>43</td>\n      <td>241</td>\n      <td>129</td>\n      <td>141</td>\n      <td>123</td>\n      <td>1407</td>\n      <td>539</td>\n      <td>2</td>\n      <td>2623</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>G17003100005</th>\n      <td>337.1</td>\n      <td>20</td>\n      <td>0.431822</td>\n      <td>0.084703</td>\n      <td>65</td>\n      <td>464</td>\n      <td>369</td>\n      <td>464</td>\n      <td>328</td>\n      <td>2625</td>\n      <td>1213</td>\n      <td>7</td>\n      <td>5528</td>\n      <td>1</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Remove columns\n\nPermanently deleting variables is also within reach of one command:\n\n::: {#58afa35b .cell execution_count=20}\n``` {.python .cell-code}\nchicago_1918 = chicago_1918.drop(columns=\"ones\")\nchicago_1918.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=20}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>1388.2</td>\n      <td>116</td>\n      <td>0.376950</td>\n      <td>0.124823</td>\n      <td>46</td>\n      <td>274</td>\n      <td>257</td>\n      <td>311</td>\n      <td>222</td>\n      <td>1122</td>\n      <td>587</td>\n      <td>9</td>\n      <td>2819</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>217.7</td>\n      <td>14</td>\n      <td>0.399571</td>\n      <td>0.071647</td>\n      <td>35</td>\n      <td>320</td>\n      <td>441</td>\n      <td>624</td>\n      <td>276</td>\n      <td>1061</td>\n      <td>508</td>\n      <td>6</td>\n      <td>3265</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>401.3</td>\n      <td>69</td>\n      <td>0.349558</td>\n      <td>0.092920</td>\n      <td>50</td>\n      <td>265</td>\n      <td>179</td>\n      <td>187</td>\n      <td>163</td>\n      <td>1020</td>\n      <td>392</td>\n      <td>8</td>\n      <td>2256</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>86.9</td>\n      <td>11</td>\n      <td>0.422535</td>\n      <td>0.030072</td>\n      <td>43</td>\n      <td>241</td>\n      <td>129</td>\n      <td>141</td>\n      <td>123</td>\n      <td>1407</td>\n      <td>539</td>\n      <td>2</td>\n      <td>2623</td>\n    </tr>\n    <tr>\n      <th>G17003100005</th>\n      <td>337.1</td>\n      <td>20</td>\n      <td>0.431822</td>\n      <td>0.084703</td>\n      <td>65</td>\n      <td>464</td>\n      <td>369</td>\n      <td>464</td>\n      <td>328</td>\n      <td>2625</td>\n      <td>1213</td>\n      <td>7</td>\n      <td>5528</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Index-based queries\n\nHere, you explore how to subset parts of a `DataFrame` if you know exactly which bits\nyou want. For example, if you want to extract the influenza mortality and total population of the\nfirst four areas in the table, you use `loc` with lists:\n\n::: {#84c809f0 .cell execution_count=21}\n``` {.python .cell-code}\ndeath_pop_first4 = chicago_1918.loc[                                   # <1>\n    [\"G17003100001\", \"G17003100002\", \"G17003100003\", \"G17003100004\"],  # <2>\n    [\"influenza\", \"total_population\"],                                 # <3>\n]\ndeath_pop_first4\n```\n\n::: {.cell-output .cell-output-display execution_count=21}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>9</td>\n      <td>2819</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>6</td>\n      <td>3265</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>8</td>\n      <td>2256</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>2</td>\n      <td>2623</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n1. `loc` takes two inputs. Selection of rows and selection of columns. If the latter is\nnot present, it is assumed that all the columns are selected. The same could be achieved by using `:`.\n2. A `list` of index values. Note that you use squared brackets (`[]`) to delineate the\nindex of the items you want to subset. In Python, this sequence of items is called a list.\n3. A `list` of columns.\n\nYou can see how you can create a list with the names (index IDs) along each of the two\ndimensions of a `DataFrame` (rows and columns), and `loc` will return a subset of the\noriginal table only with the elements queried for.\n\nAn alternative to list-based queries is what is called “range-based” queries. These work\non the indices of the table, but instead of requiring the ID of each item you want to\nretrieve, they operate by requiring only two IDs: the first and last element in a range\nof items. Range queries are expressed with a colon (`:`). For example:\n\n::: {#028a1844 .cell execution_count=22}\n``` {.python .cell-code}\nrange_query = chicago_1918.loc[\n    \"G17003100010\":\"G17003100012\",\n    \"influenza\":'total_population',\n]\nrange_query\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100010</th>\n      <td>18</td>\n      <td>11380</td>\n    </tr>\n    <tr>\n      <th>G17003100011</th>\n      <td>16</td>\n      <td>8382</td>\n    </tr>\n    <tr>\n      <th>G17003100012</th>\n      <td>8</td>\n      <td>5874</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nThe range query picks up all the elements between the specified IDs. Note that for this\nto work, the first ID in the range needs to be placed before the second one in the table’s index.\n\nOnce you know about list and range-based queries, you can combine them! For example, you\ncan specify a range of rows and a list of columns:\n\n::: {#cf7ec298 .cell execution_count=23}\n``` {.python .cell-code}\nrange_list_qry = chicago_1918.loc[\n    \"G17003100010\":\"G17003100012\", [\"influenza\", \"total_population\"]\n]\n\nrange_list_qry\n```\n\n::: {.cell-output .cell-output-display execution_count=23}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100010</th>\n      <td>18</td>\n      <td>11380</td>\n    </tr>\n    <tr>\n      <th>G17003100011</th>\n      <td>16</td>\n      <td>8382</td>\n    </tr>\n    <tr>\n      <th>G17003100012</th>\n      <td>8</td>\n      <td>5874</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Condition-based queries\n\nHowever, sometimes, you do not know exactly which observations you want, but you do know\nwhat conditions they need to satisfy (e.g. areas with more than 2,000 inhabitants). For\nthese cases, `DataFrames` support selection based on conditions. Let us see a few examples.\nSuppose you want to select...\n\n_... areas with more than 60 cases of influenza deaths:_\n\n::: {#8f417ed7 .cell execution_count=24}\n``` {.python .cell-code}\nflu_over_60 = chicago_1918.loc[chicago_1918[\"influenza\"] > 60]\nflu_over_60\n```\n\n::: {.cell-output .cell-output-display execution_count=24}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100196</th>\n      <td>80.5</td>\n      <td>951</td>\n      <td>0.301564</td>\n      <td>0.016648</td>\n      <td>228</td>\n      <td>1504</td>\n      <td>925</td>\n      <td>998</td>\n      <td>608</td>\n      <td>3583</td>\n      <td>1092</td>\n      <td>62</td>\n      <td>8938</td>\n    </tr>\n    <tr>\n      <th>G17003100246</th>\n      <td>113.0</td>\n      <td>2596</td>\n      <td>0.330517</td>\n      <td>0.027537</td>\n      <td>407</td>\n      <td>2090</td>\n      <td>1497</td>\n      <td>1681</td>\n      <td>1063</td>\n      <td>4564</td>\n      <td>1934</td>\n      <td>77</td>\n      <td>13236</td>\n    </tr>\n    <tr>\n      <th>G17003100247</th>\n      <td>91.1</td>\n      <td>1534</td>\n      <td>0.293748</td>\n      <td>0.020664</td>\n      <td>215</td>\n      <td>1136</td>\n      <td>770</td>\n      <td>775</td>\n      <td>530</td>\n      <td>2993</td>\n      <td>1152</td>\n      <td>61</td>\n      <td>7571</td>\n    </tr>\n    <tr>\n      <th>G17003100285</th>\n      <td>120.0</td>\n      <td>621</td>\n      <td>0.318677</td>\n      <td>0.047779</td>\n      <td>419</td>\n      <td>1870</td>\n      <td>1190</td>\n      <td>1263</td>\n      <td>818</td>\n      <td>4370</td>\n      <td>1335</td>\n      <td>82</td>\n      <td>11265</td>\n    </tr>\n    <tr>\n      <th>G17003100352</th>\n      <td>600.0</td>\n      <td>638</td>\n      <td>0.267962</td>\n      <td>0.055023</td>\n      <td>404</td>\n      <td>1962</td>\n      <td>1251</td>\n      <td>1151</td>\n      <td>603</td>\n      <td>5261</td>\n      <td>1251</td>\n      <td>70</td>\n      <td>11883</td>\n    </tr>\n    <tr>\n      <th>G17003100494</th>\n      <td>1392.8</td>\n      <td>1504</td>\n      <td>0.336032</td>\n      <td>0.072317</td>\n      <td>309</td>\n      <td>1779</td>\n      <td>1252</td>\n      <td>1598</td>\n      <td>1086</td>\n      <td>6235</td>\n      <td>2673</td>\n      <td>85</td>\n      <td>14932</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n_... areas with less than 200 inhabitants:_\n\n::: {#97ddbcf0 .cell execution_count=25}\n``` {.python .cell-code}\npop_under = chicago_1918.loc[chicago_1918[\"total_population\"] < 200]\npop_under\n```\n\n::: {.cell-output .cell-output-display execution_count=25}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100093</th>\n      <td>71.2</td>\n      <td>34</td>\n      <td>0.268041</td>\n      <td>0.025773</td>\n      <td>4</td>\n      <td>33</td>\n      <td>20</td>\n      <td>25</td>\n      <td>10</td>\n      <td>66</td>\n      <td>36</td>\n      <td>0</td>\n      <td>194</td>\n    </tr>\n    <tr>\n      <th>G17003100293</th>\n      <td>40.0</td>\n      <td>17</td>\n      <td>0.345238</td>\n      <td>0.053571</td>\n      <td>4</td>\n      <td>23</td>\n      <td>18</td>\n      <td>26</td>\n      <td>16</td>\n      <td>59</td>\n      <td>22</td>\n      <td>0</td>\n      <td>168</td>\n    </tr>\n    <tr>\n      <th>G17003100297</th>\n      <td>38.1</td>\n      <td>4</td>\n      <td>0.461538</td>\n      <td>0.000000</td>\n      <td>0</td>\n      <td>3</td>\n      <td>1</td>\n      <td>4</td>\n      <td>0</td>\n      <td>8</td>\n      <td>10</td>\n      <td>0</td>\n      <td>26</td>\n    </tr>\n    <tr>\n      <th>G17003100353</th>\n      <td>320.0</td>\n      <td>28</td>\n      <td>0.193750</td>\n      <td>0.018750</td>\n      <td>1</td>\n      <td>7</td>\n      <td>4</td>\n      <td>10</td>\n      <td>12</td>\n      <td>80</td>\n      <td>46</td>\n      <td>2</td>\n      <td>160</td>\n    </tr>\n    <tr>\n      <th>G17003100488</th>\n      <td>1600.1</td>\n      <td>3</td>\n      <td>0.404762</td>\n      <td>0.000000</td>\n      <td>2</td>\n      <td>5</td>\n      <td>4</td>\n      <td>7</td>\n      <td>1</td>\n      <td>17</td>\n      <td>6</td>\n      <td>0</td>\n      <td>42</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n_... areas with exactly a hundred illiterate persons:_\n\n::: {#6729fb26 .cell execution_count=26}\n``` {.python .cell-code}\nillit_100 = chicago_1918.loc[chicago_1918[\"illit\"] == 100]\nillit_100\n```\n\n::: {.cell-output .cell-output-display execution_count=26}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100076</th>\n      <td>79.4</td>\n      <td>100</td>\n      <td>0.326936</td>\n      <td>0.043691</td>\n      <td>140</td>\n      <td>791</td>\n      <td>562</td>\n      <td>666</td>\n      <td>520</td>\n      <td>3163</td>\n      <td>1496</td>\n      <td>20</td>\n      <td>7338</td>\n    </tr>\n    <tr>\n      <th>G17003100483</th>\n      <td>670.0</td>\n      <td>100</td>\n      <td>0.379153</td>\n      <td>0.142368</td>\n      <td>188</td>\n      <td>1170</td>\n      <td>829</td>\n      <td>1132</td>\n      <td>763</td>\n      <td>3191</td>\n      <td>1482</td>\n      <td>21</td>\n      <td>8755</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n::: {.callout-note}\n# Unlimited power\n\nThese queries can grow in sophistication with almost no limits. For example, here is a\ncase where you want to find out the areas where the oldest age group is more than half the\npopulation:\n\n::: {#219b2016 .cell execution_count=27}\n``` {.python .cell-code}\nchicago_1918.loc[\n    (chicago_1918[\"agecat7\"] * 100 / chicago_1918[\"total_population\"]) > 50\n]\n```\n\n::: {.cell-output .cell-output-display execution_count=27}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100227</th>\n      <td>146.3</td>\n      <td>22</td>\n      <td>0.0657</td>\n      <td>0.000853</td>\n      <td>2</td>\n      <td>16</td>\n      <td>9</td>\n      <td>22</td>\n      <td>27</td>\n      <td>480</td>\n      <td>614</td>\n      <td>3</td>\n      <td>1170</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n:::\n\nAll the condition-based queries above are expressed using the `loc` operator. This is a\npowerful way, and since it shares syntax with index-based queries, it is also easier to\nremember. However, sometimes querying using `loc` involves a lot of quotation marks,\nparenthesis, etc. A more streamlined approach for condition-based queries of rows is\nprovided by the `query` engine. Using this approach, you express everything in our query\non a single string, or piece of text, and that is evaluated in the table at once. For\nexample, you can run the same operation as in the first query above with the following\nsyntax:\n\n::: {#419d54b4 .cell execution_count=28}\n``` {.python .cell-code}\nflu_over_60_query = chicago_1918.query(\"influenza > 60\")\nflu_over_60_query\n```\n\n::: {.cell-output .cell-output-display execution_count=28}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100196</th>\n      <td>80.5</td>\n      <td>951</td>\n      <td>0.301564</td>\n      <td>0.016648</td>\n      <td>228</td>\n      <td>1504</td>\n      <td>925</td>\n      <td>998</td>\n      <td>608</td>\n      <td>3583</td>\n      <td>1092</td>\n      <td>62</td>\n      <td>8938</td>\n    </tr>\n    <tr>\n      <th>G17003100246</th>\n      <td>113.0</td>\n      <td>2596</td>\n      <td>0.330517</td>\n      <td>0.027537</td>\n      <td>407</td>\n      <td>2090</td>\n      <td>1497</td>\n      <td>1681</td>\n      <td>1063</td>\n      <td>4564</td>\n      <td>1934</td>\n      <td>77</td>\n      <td>13236</td>\n    </tr>\n    <tr>\n      <th>G17003100247</th>\n      <td>91.1</td>\n      <td>1534</td>\n      <td>0.293748</td>\n      <td>0.020664</td>\n      <td>215</td>\n      <td>1136</td>\n      <td>770</td>\n      <td>775</td>\n      <td>530</td>\n      <td>2993</td>\n      <td>1152</td>\n      <td>61</td>\n      <td>7571</td>\n    </tr>\n    <tr>\n      <th>G17003100285</th>\n      <td>120.0</td>\n      <td>621</td>\n      <td>0.318677</td>\n      <td>0.047779</td>\n      <td>419</td>\n      <td>1870</td>\n      <td>1190</td>\n      <td>1263</td>\n      <td>818</td>\n      <td>4370</td>\n      <td>1335</td>\n      <td>82</td>\n      <td>11265</td>\n    </tr>\n    <tr>\n      <th>G17003100352</th>\n      <td>600.0</td>\n      <td>638</td>\n      <td>0.267962</td>\n      <td>0.055023</td>\n      <td>404</td>\n      <td>1962</td>\n      <td>1251</td>\n      <td>1151</td>\n      <td>603</td>\n      <td>5261</td>\n      <td>1251</td>\n      <td>70</td>\n      <td>11883</td>\n    </tr>\n    <tr>\n      <th>G17003100494</th>\n      <td>1392.8</td>\n      <td>1504</td>\n      <td>0.336032</td>\n      <td>0.072317</td>\n      <td>309</td>\n      <td>1779</td>\n      <td>1252</td>\n      <td>1598</td>\n      <td>1086</td>\n      <td>6235</td>\n      <td>2673</td>\n      <td>85</td>\n      <td>14932</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nIf you want to combine operations, this is also possible:\n\n::: {#8a5a6dff .cell execution_count=29}\n``` {.python .cell-code}\nflu_query = chicago_1918.query(\"(influenza > 60) & (total_population < 10000)\")\nflu_query\n```\n\n::: {.cell-output .cell-output-display execution_count=29}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100196</th>\n      <td>80.5</td>\n      <td>951</td>\n      <td>0.301564</td>\n      <td>0.016648</td>\n      <td>228</td>\n      <td>1504</td>\n      <td>925</td>\n      <td>998</td>\n      <td>608</td>\n      <td>3583</td>\n      <td>1092</td>\n      <td>62</td>\n      <td>8938</td>\n    </tr>\n    <tr>\n      <th>G17003100247</th>\n      <td>91.1</td>\n      <td>1534</td>\n      <td>0.293748</td>\n      <td>0.020664</td>\n      <td>215</td>\n      <td>1136</td>\n      <td>770</td>\n      <td>775</td>\n      <td>530</td>\n      <td>2993</td>\n      <td>1152</td>\n      <td>61</td>\n      <td>7571</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nNote that, in these cases, using query results in code that is much more streamlined and\neasier to read. However, `query` is not perfect and, particularly for more sophisticated\nqueries, it does not afford the same degree of flexibility. For example, the last `query`\nwe had using loc would not be possible using `query`.\n\n::: {.callout-tip}\nIf you are interested, more detail about `query` is available in the\n[pandas documentation](https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#the-query-method).\n:::\n\n### Combining queries\n\nNow, all of these queries can be combined with each other for further flexibility. For\nexample, imagine you want areas with more than 60 cases of influenza from areas with less than 10,000 inhabitants:\n\n::: {#327dd92e .cell execution_count=30}\n``` {.python .cell-code}\nflu_loc = chicago_1918.loc[\n    (chicago_1918[\"influenza\"] > 60)\n    & (chicago_1918[\"total_population\"] < 10000)  # <1>\n]\nflu_loc\n```\n\n::: {.cell-output .cell-output-display execution_count=30}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100196</th>\n      <td>80.5</td>\n      <td>951</td>\n      <td>0.301564</td>\n      <td>0.016648</td>\n      <td>228</td>\n      <td>1504</td>\n      <td>925</td>\n      <td>998</td>\n      <td>608</td>\n      <td>3583</td>\n      <td>1092</td>\n      <td>62</td>\n      <td>8938</td>\n    </tr>\n    <tr>\n      <th>G17003100247</th>\n      <td>91.1</td>\n      <td>1534</td>\n      <td>0.293748</td>\n      <td>0.020664</td>\n      <td>215</td>\n      <td>1136</td>\n      <td>770</td>\n      <td>775</td>\n      <td>530</td>\n      <td>2993</td>\n      <td>1152</td>\n      <td>61</td>\n      <td>7571</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n1. The `&` operator combines both conditions together.\n\n::: {.callout-note collapse=\"true\"}\n## How do the `loc` queries work?\n\nLet's unpack how these queries work. Each part of the query above creates a single\n`Series` with boolean (`True` or `False`) values, encoding whether the row fulfils the condition\nor not.\n\n::: {#ab529c00 .cell execution_count=31}\n``` {.python .cell-code}\nchicago_1918[\"influenza\"] > 60\n```\n\n::: {.cell-output .cell-output-display execution_count=31}\n```\ngeography_code\nG17003100001    False\nG17003100002    False\nG17003100003    False\nG17003100004    False\nG17003100005    False\n                ...  \nG17003100492    False\nG17003100493    False\nG17003100494     True\nG17003100495    False\nG17003100496    False\nName: influenza, Length: 496, dtype: bool\n```\n:::\n:::\n\n\n::: {#1f499708 .cell execution_count=32}\n``` {.python .cell-code}\nchicago_1918[\"total_population\"] < 10000\n```\n\n::: {.cell-output .cell-output-display execution_count=32}\n```\ngeography_code\nG17003100001     True\nG17003100002     True\nG17003100003     True\nG17003100004     True\nG17003100005     True\n                ...  \nG17003100492     True\nG17003100493    False\nG17003100494    False\nG17003100495     True\nG17003100496     True\nName: total_population, Length: 496, dtype: bool\n```\n:::\n:::\n\n\nYou then combine two of these Series with `&`, asking for a new `Series` where values in\nboth the first and the second `Series` are `True`.\n\n::: {#9114366b .cell execution_count=33}\n``` {.python .cell-code}\n(chicago_1918[\"influenza\"] > 60) & (chicago_1918[\"total_population\"] < 10000)\n```\n\n::: {.cell-output .cell-output-display execution_count=33}\n```\ngeography_code\nG17003100001    False\nG17003100002    False\nG17003100003    False\nG17003100004    False\nG17003100005    False\n                ...  \nG17003100492    False\nG17003100493    False\nG17003100494    False\nG17003100495    False\nG17003100496    False\nLength: 496, dtype: bool\n```\n:::\n:::\n\n\nSuch a `Series` is then essentially used as a mask, and `loc` returns only those columns\nthat contain `True` in that mask.\n:::\n\n### Sorting\n\nAmong the many operations `DataFrame` objects support, one of the most useful ones is to\nsort a table based on a given column. For example, imagine you want to sort the table by\nthe influenza cases:\n\n::: {#75e08988 .cell execution_count=34}\n``` {.python .cell-code}\nchicago_sorted = chicago_1918.sort_values('influenza', ascending=False)  # <1>\nchicago_sorted\n```\n\n::: {.cell-output .cell-output-display execution_count=34}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100494</th>\n      <td>1392.8</td>\n      <td>1504</td>\n      <td>0.336032</td>\n      <td>0.072317</td>\n      <td>309</td>\n      <td>1779</td>\n      <td>1252</td>\n      <td>1598</td>\n      <td>1086</td>\n      <td>6235</td>\n      <td>2673</td>\n      <td>85</td>\n      <td>14932</td>\n    </tr>\n    <tr>\n      <th>G17003100285</th>\n      <td>120.0</td>\n      <td>621</td>\n      <td>0.318677</td>\n      <td>0.047779</td>\n      <td>419</td>\n      <td>1870</td>\n      <td>1190</td>\n      <td>1263</td>\n      <td>818</td>\n      <td>4370</td>\n      <td>1335</td>\n      <td>82</td>\n      <td>11265</td>\n    </tr>\n    <tr>\n      <th>G17003100246</th>\n      <td>113.0</td>\n      <td>2596</td>\n      <td>0.330517</td>\n      <td>0.027537</td>\n      <td>407</td>\n      <td>2090</td>\n      <td>1497</td>\n      <td>1681</td>\n      <td>1063</td>\n      <td>4564</td>\n      <td>1934</td>\n      <td>77</td>\n      <td>13236</td>\n    </tr>\n    <tr>\n      <th>G17003100352</th>\n      <td>600.0</td>\n      <td>638</td>\n      <td>0.267962</td>\n      <td>0.055023</td>\n      <td>404</td>\n      <td>1962</td>\n      <td>1251</td>\n      <td>1151</td>\n      <td>603</td>\n      <td>5261</td>\n      <td>1251</td>\n      <td>70</td>\n      <td>11883</td>\n    </tr>\n    <tr>\n      <th>G17003100196</th>\n      <td>80.5</td>\n      <td>951</td>\n      <td>0.301564</td>\n      <td>0.016648</td>\n      <td>228</td>\n      <td>1504</td>\n      <td>925</td>\n      <td>998</td>\n      <td>608</td>\n      <td>3583</td>\n      <td>1092</td>\n      <td>62</td>\n      <td>8938</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>G17003100297</th>\n      <td>38.1</td>\n      <td>4</td>\n      <td>0.461538</td>\n      <td>0.000000</td>\n      <td>0</td>\n      <td>3</td>\n      <td>1</td>\n      <td>4</td>\n      <td>0</td>\n      <td>8</td>\n      <td>10</td>\n      <td>0</td>\n      <td>26</td>\n    </tr>\n    <tr>\n      <th>G17003100209</th>\n      <td>124.1</td>\n      <td>13</td>\n      <td>0.438105</td>\n      <td>0.062971</td>\n      <td>30</td>\n      <td>120</td>\n      <td>92</td>\n      <td>196</td>\n      <td>166</td>\n      <td>763</td>\n      <td>491</td>\n      <td>0</td>\n      <td>1858</td>\n    </tr>\n    <tr>\n      <th>G17003100293</th>\n      <td>40.0</td>\n      <td>17</td>\n      <td>0.345238</td>\n      <td>0.053571</td>\n      <td>4</td>\n      <td>23</td>\n      <td>18</td>\n      <td>26</td>\n      <td>16</td>\n      <td>59</td>\n      <td>22</td>\n      <td>0</td>\n      <td>168</td>\n    </tr>\n    <tr>\n      <th>G17003100202</th>\n      <td>13.1</td>\n      <td>6</td>\n      <td>0.323326</td>\n      <td>0.027714</td>\n      <td>5</td>\n      <td>40</td>\n      <td>24</td>\n      <td>37</td>\n      <td>28</td>\n      <td>218</td>\n      <td>78</td>\n      <td>0</td>\n      <td>430</td>\n    </tr>\n    <tr>\n      <th>G17003100396</th>\n      <td>26.2</td>\n      <td>8</td>\n      <td>0.344066</td>\n      <td>0.015639</td>\n      <td>14</td>\n      <td>54</td>\n      <td>31</td>\n      <td>53</td>\n      <td>48</td>\n      <td>609</td>\n      <td>275</td>\n      <td>0</td>\n      <td>1084</td>\n    </tr>\n  </tbody>\n</table>\n<p>496 rows × 13 columns</p>\n</div>\n```\n:::\n:::\n\n\n1. By default, `pandas` is sorting from the smallest to the largest values (ascending).\nBy specifying `ascending=False`, you switch the order.\n\nGiven the areas of each census tract differ, it may be better to sort by the mortality rate\nrather than raw counts.\n\n::: {#354f5d16 .cell execution_count=35}\n``` {.python .cell-code}\nchicago_1918[\"flu_rate\"] = (                                                # <1>\n    chicago_1918[\"influenza\"] / chicago_1918[\"total_population\"]            # <1>\n)                                                                           # <1>\nchicago_sorted_rel = chicago_1918.sort_values('flu_rate', ascending=False)  # <2>\nchicago_sorted_rel\n```\n\n::: {.cell-output .cell-output-display execution_count=35}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n      <th>flu_rate</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100086</th>\n      <td>140.7</td>\n      <td>153</td>\n      <td>0.331750</td>\n      <td>0.034838</td>\n      <td>39</td>\n      <td>179</td>\n      <td>144</td>\n      <td>197</td>\n      <td>111</td>\n      <td>399</td>\n      <td>189</td>\n      <td>26</td>\n      <td>1258</td>\n      <td>0.020668</td>\n    </tr>\n    <tr>\n      <th>G17003100022</th>\n      <td>233.2</td>\n      <td>20</td>\n      <td>0.369973</td>\n      <td>0.107239</td>\n      <td>6</td>\n      <td>28</td>\n      <td>35</td>\n      <td>48</td>\n      <td>28</td>\n      <td>151</td>\n      <td>77</td>\n      <td>7</td>\n      <td>373</td>\n      <td>0.018767</td>\n    </tr>\n    <tr>\n      <th>G17003100261</th>\n      <td>164.9</td>\n      <td>287</td>\n      <td>0.307767</td>\n      <td>0.031068</td>\n      <td>25</td>\n      <td>126</td>\n      <td>92</td>\n      <td>113</td>\n      <td>87</td>\n      <td>414</td>\n      <td>172</td>\n      <td>18</td>\n      <td>1029</td>\n      <td>0.017493</td>\n    </tr>\n    <tr>\n      <th>G17003100282</th>\n      <td>293.5</td>\n      <td>97</td>\n      <td>0.142330</td>\n      <td>0.044248</td>\n      <td>15</td>\n      <td>70</td>\n      <td>67</td>\n      <td>74</td>\n      <td>198</td>\n      <td>758</td>\n      <td>173</td>\n      <td>20</td>\n      <td>1355</td>\n      <td>0.014760</td>\n    </tr>\n    <tr>\n      <th>G17003100249</th>\n      <td>137.0</td>\n      <td>317</td>\n      <td>0.337257</td>\n      <td>0.017202</td>\n      <td>63</td>\n      <td>314</td>\n      <td>277</td>\n      <td>345</td>\n      <td>171</td>\n      <td>718</td>\n      <td>320</td>\n      <td>31</td>\n      <td>2208</td>\n      <td>0.014040</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>G17003100202</th>\n      <td>13.1</td>\n      <td>6</td>\n      <td>0.323326</td>\n      <td>0.027714</td>\n      <td>5</td>\n      <td>40</td>\n      <td>24</td>\n      <td>37</td>\n      <td>28</td>\n      <td>218</td>\n      <td>78</td>\n      <td>0</td>\n      <td>430</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>G17003100093</th>\n      <td>71.2</td>\n      <td>34</td>\n      <td>0.268041</td>\n      <td>0.025773</td>\n      <td>4</td>\n      <td>33</td>\n      <td>20</td>\n      <td>25</td>\n      <td>10</td>\n      <td>66</td>\n      <td>36</td>\n      <td>0</td>\n      <td>194</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>G17003100293</th>\n      <td>40.0</td>\n      <td>17</td>\n      <td>0.345238</td>\n      <td>0.053571</td>\n      <td>4</td>\n      <td>23</td>\n      <td>18</td>\n      <td>26</td>\n      <td>16</td>\n      <td>59</td>\n      <td>22</td>\n      <td>0</td>\n      <td>168</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>G17003100297</th>\n      <td>38.1</td>\n      <td>4</td>\n      <td>0.461538</td>\n      <td>0.000000</td>\n      <td>0</td>\n      <td>3</td>\n      <td>1</td>\n      <td>4</td>\n      <td>0</td>\n      <td>8</td>\n      <td>10</td>\n      <td>0</td>\n      <td>26</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>G17003100488</th>\n      <td>1600.1</td>\n      <td>3</td>\n      <td>0.404762</td>\n      <td>0.000000</td>\n      <td>2</td>\n      <td>5</td>\n      <td>4</td>\n      <td>7</td>\n      <td>1</td>\n      <td>17</td>\n      <td>6</td>\n      <td>0</td>\n      <td>42</td>\n      <td>0.000000</td>\n    </tr>\n  </tbody>\n</table>\n<p>496 rows × 14 columns</p>\n</div>\n```\n:::\n:::\n\n\n1. Compute the relative rate and assign it as a new column.\n2. Sort values by this new column.\n\nIf you inspect the help of `chicago_1918.sort_values`, you will find that you can pass\nmore than one column to sort the table by. This allows you to do so-called hierarchical\nsorting: sort first based on one column, if equal, then based on another column, etc.\n\n## Visual Exploration\n\nThe next step to continue exploring a dataset is to get a feel for what it looks like, visually. You have already learnt how to unconver and inspect specific parts of the data, to check for particular cases you might be interested in. Now, you will see how to plot the data to get a sense of the overall distribution of values. For that, you can use the plotting capabilities of `pandas`.\n\n### Histograms\n\nOne of the most common graphical devices to display the distribution of values in a variable is a histogram. Values are assigned into groups of equal intervals, and the groups are plotted as bars rising as high as the number of values into the group.\n\nA histogram is easily created with the following command. In this case, let us have a look at the shape of the overall influenza rates:\n\n::: {#e40b46e8 .cell execution_count=36}\n``` {.python .cell-code}\n_ = chicago_1918[\"influenza\"].plot.hist()\n```\n\n::: {.cell-output .cell-output-display}\n![](hands_on_files/figure-html/cell-37-output-1.png){width=593 height=411}\n:::\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n# Assigning to `_`\n\n`pandas` returns an object with the drawing from its plotting methods. Since you are in\nJupyter environment, and you don't need to work further with that object; you can assign\nit to `_`, a convention for an unused variable.\n:::\n\nHowever, the default `pandas` plots can be a bit dull. A better option is to use another\npackage, called [`seaborn`](https://seaborn.pydata.org).\n\n::: {#7fc8642d .cell execution_count=37}\n``` {.python .cell-code}\nimport seaborn as sns\n```\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n# Why `sns`?\n\n`seaborn` is, by convention, imported as `sns`. That came as a joke after\n[Samuel Normal Seaborn](https://en.wikipedia.org/wiki/Sam_Seaborn),\na fictional character The West Wing show.\n:::\n\nThe same plot using `seaborn` has a more pleasant default style and more customisability.\n\n::: {#c8c89c3d .cell execution_count=38}\n``` {.python .cell-code}\nsns.displot(chicago_1918[\"influenza\"])\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/martin/mambaforge/envs/sds/lib/python3.11/site-packages/seaborn/axisgrid.py:118: UserWarning: The figure layout has changed to tight\n  self._figure.tight_layout(*args, **kwargs)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](hands_on_files/figure-html/cell-39-output-2.png){width=469 height=468}\n:::\n:::\n\n\nNote you are using `sns` instead of `pd`, as the function belongs to `seaborn` instead of `pandas`.\n\n You can quickly see most of the areas have seen somewhere between 0 and 60 cases, approx. However, there are a few areas that have more, up to more than 80 cases.\n\n### Kernel Density Plots\n\nHistograms are useful, but they are artificial in the sense that a continuous variable is made discrete by turning the values into discrete groups. An alternative is kernel density estimation (KDE), which produces an empirical density function:\n\n::: {#c127db1d .cell execution_count=39}\n``` {.python .cell-code}\nsns.displot(chicago_1918[\"influenza\"], kind=\"kde\", fill=True)  # <1>\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n/Users/martin/mambaforge/envs/sds/lib/python3.11/site-packages/seaborn/axisgrid.py:118: UserWarning: The figure layout has changed to tight\n  self._figure.tight_layout(*args, **kwargs)\n```\n:::\n\n::: {.cell-output .cell-output-display}\n![](hands_on_files/figure-html/cell-40-output-2.png){width=470 height=468}\n:::\n:::\n\n\n1. `kind=\"kde\"` specifies which type of a distribution plot should `seaborn` use and\n`fill=True` tells it to colour the area under the KDE curve.\n\n### Line and bar plots\n\nAnother very common way of visually displaying a variable is with a line or a bar chart. For example, if you want to generate a line plot of the (sorted) total cases by area:\n\n::: {#c9327f6a .cell execution_count=40}\n``` {.python .cell-code}\n_ = chicago_1918[\"influenza\"].sort_values(ascending=False).plot()\n```\n\n::: {.cell-output .cell-output-display}\n![](hands_on_files/figure-html/cell-41-output-1.png){width=568 height=429}\n:::\n:::\n\n\nFor a bar plot all you need to do is to change from `plot` to `plot.bar`. Since there are many census tracts, let us plot only the ten largest ones (which you can retrieve with `head`):\n\n::: {#4cf0fae8 .cell execution_count=41}\n``` {.python .cell-code}\n_ = chicago_1918[\"influenza\"].sort_values(ascending=False).head(10).plot.bar()\n```\n\n::: {.cell-output .cell-output-display}\n![](hands_on_files/figure-html/cell-42-output-1.png){width=566 height=520}\n:::\n:::\n\n\n You can turn the plot around by displaying the bars horizontally (see how it's just changing `bar` for `barh`). Let's display now the top 50 areas and, to make it more readable, let us expand the plot's height:\n\n::: {#36aabfc7 .cell execution_count=42}\n``` {.python .cell-code}\n_ = (\n    chicago_1918[\"total_population\"]\n    .sort_values()\n    .head(50)\n    .plot.barh(figsize=(6, 20))\n)\n```\n\n::: {.cell-output .cell-output-display}\n![](hands_on_files/figure-html/cell-43-output-1.png){width=597 height=1520}\n:::\n:::\n\n\n::: {.callout-note}\n# One line or multiple lines?\n\nYou may have noticed that in some cases, the code is on a single line, but longer code\nis split into multiple lines. Python requires you to follow the [indentation rules](https://peps.python.org/pep-0008/), but\napart from that, there are not a lot of other limits.\n:::\n\n## Tidy data\n\n::: {.callout-caution}\nThis section is a bit more advanced and hence considered optional. Feel free to skip it, move to the next, and return later when you feel more confident.\n:::\n\nOnce you can read your data in, explore specific cases, and have a first visual approach to the entire set, the next step can be preparing it for more sophisticated analysis. Maybe you are thinking of modeling it through regression, or on creating subgroups in the dataset with particular characteristics, or maybe you simply need to present summary measures that relate to a slightly different arrangement of the data than you have been presented with.\n\nFor all these cases, you first need what statistician, and general R wizard, Hadley Wickham calls *\"tidy data\"*. The general idea to \"tidy\" your data is to convert them from whatever structure they were handed in to you into one that allows convenient and standardized manipulation, and that supports directly inputting the data into what he calls \"*tidy*\" analysis tools. But, at a more practical level, what is exactly *\"tidy data\"*? In Wickham's own words:\n\n> *Tidy data is a standard way of mapping the meaning of a dataset to its structure. A dataset is\nmessy or tidy depending on how rows, columns and tables are matched up with observations,\nvariables and types.*\n\nHe then goes on to list the three fundamental characteristics of *\"tidy data\"*:\n\n1. Each variable forms a column.\n1. Each observation forms a row.\n1. Each type of observational unit forms a table.\n\nIf you are further interested in the concept of *\"tidy data\"*, I recommend you check out the [original paper](http://www.jstatsoft.org/v59/i10/) (open access) and the [public repository](https://github.com/hadley/tidy-data) associated with it.\n\nLet us bring in the concept of \"*tidy data*\" to our own Chicago dataset. First, remember its structure:\n\n::: {#689a3ba0 .cell execution_count=43}\n``` {.python .cell-code}\nchicago_1918.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=43}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>gross_acres</th>\n      <th>illit</th>\n      <th>unemployed_pct</th>\n      <th>ho_pct</th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n      <th>influenza</th>\n      <th>total_population</th>\n      <th>flu_rate</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>1388.2</td>\n      <td>116</td>\n      <td>0.376950</td>\n      <td>0.124823</td>\n      <td>46</td>\n      <td>274</td>\n      <td>257</td>\n      <td>311</td>\n      <td>222</td>\n      <td>1122</td>\n      <td>587</td>\n      <td>9</td>\n      <td>2819</td>\n      <td>0.003193</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>217.7</td>\n      <td>14</td>\n      <td>0.399571</td>\n      <td>0.071647</td>\n      <td>35</td>\n      <td>320</td>\n      <td>441</td>\n      <td>624</td>\n      <td>276</td>\n      <td>1061</td>\n      <td>508</td>\n      <td>6</td>\n      <td>3265</td>\n      <td>0.001838</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>401.3</td>\n      <td>69</td>\n      <td>0.349558</td>\n      <td>0.092920</td>\n      <td>50</td>\n      <td>265</td>\n      <td>179</td>\n      <td>187</td>\n      <td>163</td>\n      <td>1020</td>\n      <td>392</td>\n      <td>8</td>\n      <td>2256</td>\n      <td>0.003546</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>86.9</td>\n      <td>11</td>\n      <td>0.422535</td>\n      <td>0.030072</td>\n      <td>43</td>\n      <td>241</td>\n      <td>129</td>\n      <td>141</td>\n      <td>123</td>\n      <td>1407</td>\n      <td>539</td>\n      <td>2</td>\n      <td>2623</td>\n      <td>0.000762</td>\n    </tr>\n    <tr>\n      <th>G17003100005</th>\n      <td>337.1</td>\n      <td>20</td>\n      <td>0.431822</td>\n      <td>0.084703</td>\n      <td>65</td>\n      <td>464</td>\n      <td>369</td>\n      <td>464</td>\n      <td>328</td>\n      <td>2625</td>\n      <td>1213</td>\n      <td>7</td>\n      <td>5528</td>\n      <td>0.001266</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nThinking through *tidy* lenses, this is not a tidy dataset. It is not so for each of the three conditions:\n\n* Starting by the last one (*each type of observational unit forms a table*), this dataset actually contains not one but many observational units: the different areas of Chicago, captured by `geography_code`; *and* different observatoins for each area. To *tidy* up this aspect, you can create separate tables. You will probably want population groups divided by age as one tidy table and flu rates as another.\nStart by extracting relevant columns.\n\n::: {#cd2c8955 .cell execution_count=44}\n``` {.python .cell-code}\ninfluenza_rates = chicago_1918[[\"influenza\"]]  # <1>\ninfluenza_rates.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=44}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>influenza</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>9</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>8</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>G17003100005</th>\n      <td>7</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n1. You are not selecting a single columns with `chicago_1918[\"influenza\"]` but a subset\nof columns. Just that the subset contains only one column, so you pass a list with a single\ncolumn name as `chicago_1918[[\"influenza\"]]`. Notice the double brackets.\n\n::: {#c6ae46df .cell execution_count=45}\n``` {.python .cell-code}\npopulation = chicago_1918.loc[:, \"agecat1\":\"agecat7\"]\npopulation.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=45}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>agecat1</th>\n      <th>agecat2</th>\n      <th>agecat3</th>\n      <th>agecat4</th>\n      <th>agecat5</th>\n      <th>agecat6</th>\n      <th>agecat7</th>\n    </tr>\n    <tr>\n      <th>geography_code</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>G17003100001</th>\n      <td>46</td>\n      <td>274</td>\n      <td>257</td>\n      <td>311</td>\n      <td>222</td>\n      <td>1122</td>\n      <td>587</td>\n    </tr>\n    <tr>\n      <th>G17003100002</th>\n      <td>35</td>\n      <td>320</td>\n      <td>441</td>\n      <td>624</td>\n      <td>276</td>\n      <td>1061</td>\n      <td>508</td>\n    </tr>\n    <tr>\n      <th>G17003100003</th>\n      <td>50</td>\n      <td>265</td>\n      <td>179</td>\n      <td>187</td>\n      <td>163</td>\n      <td>1020</td>\n      <td>392</td>\n    </tr>\n    <tr>\n      <th>G17003100004</th>\n      <td>43</td>\n      <td>241</td>\n      <td>129</td>\n      <td>141</td>\n      <td>123</td>\n      <td>1407</td>\n      <td>539</td>\n    </tr>\n    <tr>\n      <th>G17003100005</th>\n      <td>65</td>\n      <td>464</td>\n      <td>369</td>\n      <td>464</td>\n      <td>328</td>\n      <td>2625</td>\n      <td>1213</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nAt this point, the table `influenza_rates` is tidy: every row is an observation, every table is a variable, and there is only one observational unit in the table.\n\nThe other table (`population`), however, is not entirely tidied up yet: there is only one observational unit in the table, true; but every row is not an observation, and there are variable values as the names of columns (in other words, every column is not a variable). To obtain a fully tidy version of the table, you need to re-arrange it in a way that every row is an age category in an area, and there are three variables: `geography_code`, age category, and population count (or frequency).\n\nBecause this is actually a fairly common pattern, there is a direct way to solve it in `pandas`:\n\n::: {#4fd1a2ff .cell execution_count=46}\n``` {.python .cell-code}\ntidy_population = population.stack()\ntidy_population.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=46}\n```\ngeography_code         \nG17003100001    agecat1     46\n                agecat2    274\n                agecat3    257\n                agecat4    311\n                agecat5    222\ndtype: int64\n```\n:::\n:::\n\n\nThe method `stack`, well, \"stacks\" the different columns into rows. This fixes our \"tidiness\" problems but the type of object that is returning is not a `DataFrame`:\n\n::: {#aac66f13 .cell execution_count=47}\n``` {.python .cell-code}\ntype(tidy_population)\n```\n\n::: {.cell-output .cell-output-display execution_count=47}\n```\npandas.core.series.Series\n```\n:::\n:::\n\n\nIt is a `Series`, which really is like a `DataFrame`, but with only one column. The additional information (`geography_code` and age category) are stored in what is called an multi-index. You will skip these for now, so you would really just want to get a `DataFrame` as you know it out of the `Series`. This is also one line of code away:\n\n::: {#4e381e8c .cell execution_count=48}\n``` {.python .cell-code}\ntidy_population_df = tidy_population.reset_index()\ntidy_population_df.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=48}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>geography_code</th>\n      <th>level_1</th>\n      <th>0</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>G17003100001</td>\n      <td>agecat1</td>\n      <td>46</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>G17003100001</td>\n      <td>agecat2</td>\n      <td>274</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>G17003100001</td>\n      <td>agecat3</td>\n      <td>257</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>G17003100001</td>\n      <td>agecat4</td>\n      <td>311</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>G17003100001</td>\n      <td>agecat5</td>\n      <td>222</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nTo which you can apply to renaming to make it look better:\n\n::: {#e91f79d6 .cell execution_count=49}\n``` {.python .cell-code}\ntidy_population_df = tidy_population_df.rename(\n    columns={\"level_1\": \"age_category\", 0: \"count\"}\n)\ntidy_population_df.head()\n```\n\n::: {.cell-output .cell-output-display execution_count=49}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>geography_code</th>\n      <th>age_category</th>\n      <th>count</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>G17003100001</td>\n      <td>agecat1</td>\n      <td>46</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>G17003100001</td>\n      <td>agecat2</td>\n      <td>274</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>G17003100001</td>\n      <td>agecat3</td>\n      <td>257</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>G17003100001</td>\n      <td>agecat4</td>\n      <td>311</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>G17003100001</td>\n      <td>agecat5</td>\n      <td>222</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nNow our table is fully tidied up!\n\n## Grouping, transforming, aggregating\n\nOne of the advantage of tidy datasets is they allow to perform advanced transformations in a more direct way. One of the most common ones is what is called \"group-by\" operations. Originated in the world of databases, these operations allow you to group observations in a table by one of its labels, index, or category, and apply operations on the data group by group.\n\nFor example, given our tidy table with age categories, you might want to compute the total sum of the population by each category. This task can be split into two different ones:\n\n* Group the table in each of the different subgroups.\n* Compute the sum of `count` for each of them.\n\nTo do this in `pandas`, meet one of its workhorses, and also one of the reasons why the library has become so popular: the `groupby` operator.\n\n::: {#9d8d2a4b .cell execution_count=50}\n``` {.python .cell-code}\npop_grouped = tidy_population_df.groupby(\"age_category\")\npop_grouped\n```\n\n::: {.cell-output .cell-output-display execution_count=50}\n```\n<pandas.core.groupby.generic.DataFrameGroupBy object at 0x141cd1e10>\n```\n:::\n:::\n\n\nThe object `pop_grouped` still hasn't computed anything. It is only a convenient way of specifying the grouping. But this allows us then to perform a multitude of operations on it. For our example, the sum is calculated as follows:\n\n::: {#1dbc6c1a .cell execution_count=51}\n``` {.python .cell-code}\npop_grouped.sum(numeric_only=True)  # <1>\n```\n\n::: {.cell-output .cell-output-display execution_count=51}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>count</th>\n    </tr>\n    <tr>\n      <th>age_category</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>agecat1</th>\n      <td>50776</td>\n    </tr>\n    <tr>\n      <th>agecat2</th>\n      <td>275363</td>\n    </tr>\n    <tr>\n      <th>agecat3</th>\n      <td>201654</td>\n    </tr>\n    <tr>\n      <th>agecat4</th>\n      <td>259954</td>\n    </tr>\n    <tr>\n      <th>agecat5</th>\n      <td>206358</td>\n    </tr>\n    <tr>\n      <th>agecat6</th>\n      <td>1171345</td>\n    </tr>\n    <tr>\n      <th>agecat7</th>\n      <td>522130</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n1. You want a sum of numeric values, not strings. Try it with `numeric_only=False` to see the difference.\n\nSimilarly, you can also obtain a summary of each group:\n\n::: {#01b9a0fa .cell execution_count=52}\n``` {.python .cell-code}\npop_grouped.describe()\n```\n\n::: {.cell-output .cell-output-display execution_count=52}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead tr th {\n        text-align: left;\n    }\n\n    .dataframe thead tr:last-of-type th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr>\n      <th></th>\n      <th colspan=\"8\" halign=\"left\">count</th>\n    </tr>\n    <tr>\n      <th></th>\n      <th>count</th>\n      <th>mean</th>\n      <th>std</th>\n      <th>min</th>\n      <th>25%</th>\n      <th>50%</th>\n      <th>75%</th>\n      <th>max</th>\n    </tr>\n    <tr>\n      <th>age_category</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>agecat1</th>\n      <td>496.0</td>\n      <td>102.370968</td>\n      <td>78.677423</td>\n      <td>0.0</td>\n      <td>46.75</td>\n      <td>82.0</td>\n      <td>136.00</td>\n      <td>427.0</td>\n    </tr>\n    <tr>\n      <th>agecat2</th>\n      <td>496.0</td>\n      <td>555.167339</td>\n      <td>423.526444</td>\n      <td>3.0</td>\n      <td>256.50</td>\n      <td>442.5</td>\n      <td>717.50</td>\n      <td>2512.0</td>\n    </tr>\n    <tr>\n      <th>agecat3</th>\n      <td>496.0</td>\n      <td>406.560484</td>\n      <td>301.564896</td>\n      <td>1.0</td>\n      <td>193.50</td>\n      <td>331.5</td>\n      <td>532.50</td>\n      <td>1917.0</td>\n    </tr>\n    <tr>\n      <th>agecat4</th>\n      <td>496.0</td>\n      <td>524.100806</td>\n      <td>369.875444</td>\n      <td>4.0</td>\n      <td>253.75</td>\n      <td>453.5</td>\n      <td>709.50</td>\n      <td>2665.0</td>\n    </tr>\n    <tr>\n      <th>agecat5</th>\n      <td>496.0</td>\n      <td>416.044355</td>\n      <td>281.825682</td>\n      <td>0.0</td>\n      <td>220.50</td>\n      <td>377.0</td>\n      <td>551.75</td>\n      <td>2454.0</td>\n    </tr>\n    <tr>\n      <th>agecat6</th>\n      <td>496.0</td>\n      <td>2361.582661</td>\n      <td>1545.469426</td>\n      <td>8.0</td>\n      <td>1169.75</td>\n      <td>2102.0</td>\n      <td>3191.75</td>\n      <td>9792.0</td>\n    </tr>\n    <tr>\n      <th>agecat7</th>\n      <td>496.0</td>\n      <td>1052.681452</td>\n      <td>722.955717</td>\n      <td>6.0</td>\n      <td>519.75</td>\n      <td>918.5</td>\n      <td>1379.25</td>\n      <td>4163.0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nYou will not get into it today as it goes beyond the basics this chapter wants to cover, but keep in mind that `groupby` allows you to not only call generic functions (like `sum` or `describe`), but also your own functions. This opens the door for virtually any kind of transformation and aggregation possible.\n\n::: {.callout-tip}\n# Additional reading\n\n- A good introduction to data manipulation in Python is Wes McKinney's \"[Python for Data Analysis](https://wesmckinney.com/book/pandas-basics)\" [@mckinney2012python].\n- To explore further some of the visualization capabilities in at your fingertips, the Python library `seaborn` is an excellent choice. Its online [tutorial](https://seaborn.pydata.org/tutorial.html) is a fantastic place to start.\n-  A good extension is Hadley Wickham's \"Tidy data\" paper [@wickham2014tidy], which presents a very popular way of organising tabular data for efficient manipulation.\n:::\n\n## Acknowledgements {.appendix}\n\nThis section is derived from _A Course on Geographic Data Science_ by\n@darribas_gds_course, licensed under CC-BY-SA 4.0. The text was slightly adapted, mostly\nto accommodate a different dataset used.\n\n",
    "supporting": [
      "hands_on_files/figure-html"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}